"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[286,45],{1726:function(e,t){window.location.hostname.toLowerCase();var n={functionResolver:"/api/FunctionResolver"};t.Z=n},7286:function(e,t,n){n.r(t),n.d(t,{default:function(){return D}});var i=n(885),r=n(2791),s=n(7907),a=n(7394),o=n(5562),c=n(9877),l=(n(5532),n(1413)),u=n(6574),d=n(184);function f(e){var t=e.items,n=e.setItems,r=e.getListStyle,s=e.getItemStyle,a=e.content,o=e.itemClickHandler,c=void 0===o?function(){}:o;return(0,d.jsx)(u.Z5,{onDragEnd:function(e){console.log(e),e.destination&&n(function(e,t,n){var r=Array.from(e),s=r.splice(t,1),a=(0,i.Z)(s,1)[0];return r.splice(n,0,a),r}(t,e.source.index,e.destination.index))},children:(0,d.jsx)(u.bK,{droppableId:"droppable",children:function(e,n){return(0,d.jsxs)("div",(0,l.Z)((0,l.Z)({},e.droppableProps),{},{ref:e.innerRef,style:r(n.isDraggingOver),children:[t.map((function(e,t){return(0,d.jsx)(u._l,{draggableId:e.id,index:t,children:function(n,i){return(0,d.jsx)("div",(0,l.Z)((0,l.Z)((0,l.Z)({onClick:function(t){return c(e,t)},ref:n.innerRef},n.draggableProps),n.dragHandleProps),{},{style:(0,l.Z)((0,l.Z)({},s(i.isDragging,e)),n.draggableProps.style),children:a(e,t)}))}},e.id)})),e.placeholder]}))}})})}var p=n(3038),v=n.n(p),h=n(8777),g=n(5413),x=n(4942),m=n(9823),Z=n(3746),j=n(165),w=n(7411),y=n(3400);function b(e){var t=e.file,n=e.name,s=e.setZoomed,a=(0,r.useState)(!1),o=(0,i.Z)(a,2);o[0],o[1];return(0,d.jsx)("img",{src:t,alt:n,className:"zoomableImageContent",onClick:function(e){e.stopPropagation(),s(t)}})}var k=function(e,t){return(0,x.Z)({border:"1px solid lightgray",borderRadius:"1.5rem",background:"white",padding:3,margin:2,overflow:"hidden",display:"flex",alignItems:"center",opacity:t.visible?1:.5,userSelect:"none"},"background",e?"lightgrey":"white")},C=function(e){return{display:"flex",flexDirection:"column",width:"100%",background:e?"rgba(0,255,255,0.1)":"transparent"}},R=function(e){var t=e.setZoomed,n=e.updateFiles,i=e.canRemove,s=void 0!==i&&i;return function(e,i){var a=e.file,o=e.progress,c=e.loaded,l=e.preview,u=e.id,f=e.visible;return(0,d.jsxs)(r.Fragment,{children:[(0,d.jsxs)("div",{style:{marginRight:"auto"},children:[s?(0,d.jsx)(w.Z,{title:"\u0423\u0431\u0440\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",children:(0,d.jsx)(y.Z,{onClick:function(){return n({type:"remove",id:u})},children:(0,d.jsx)(m.Z,{})})}):null,(0,d.jsx)(w.Z,{title:f?"\u041d\u0435 \u0438\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443":"\u0418\u0441\u043f\u043e\u043b\u044c\u0437\u043e\u0432\u0430\u0442\u044c \u043a\u0430\u0440\u0442\u0438\u043d\u043a\u0443",children:(0,d.jsx)(y.Z,{onClick:function(){return n({type:"visibility",id:u,visible:!f})},children:f?(0,d.jsx)(Z.Z,{}):(0,d.jsx)(j.Z,{})})}),i+1,") ",a.name]}),c?(0,d.jsx)(b,{file:l,name:a.name,setZoomed:t}):"".concat(Math.round(1e4*o)/100,"%")]})}},F=n(1726),S=n(5861),E=n(7757),_=n.n(E),I=n(4569),T=n.n(I),N={method:"get",headers:{"Content-Type":"application/x-www-form-urlencoded"},cors:!1};function P(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,r.useState)(null),n=(0,i.Z)(t,2),s=n[0],a=n[1],o=(0,r.useState)(!1),c=(0,i.Z)(o,2),u=c[0],d=c[1],f=(0,r.useState)(null),p=(0,i.Z)(f,2),v=p[0],h=p[1],g=(0,r.useState)(null),x=(0,i.Z)(g,2),m=x[0],Z=x[1];(0,r.useEffect)((function(){var t=function(){var t=(0,S.Z)(_().mark((function t(){var n,i;return _().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=(0,l.Z)((0,l.Z)((0,l.Z)({},N),e),m),t.next=3,T()(n);case 3:i=t.sent,h(i);case 5:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();u&&(0,S.Z)(_().mark((function e(){return _().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t();case 3:e.next=9;break;case 5:e.prev=5,e.t0=e.catch(0),console.error(e.t0),a(e.t0);case 9:d(!1);case 10:case"end":return e.stop()}}),e,null,[[0,5]])})))()}),[u,m]);var j=(0,r.useCallback)((function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};d(!0),h(null),a(null),Z(e)}),[d,h,a]);return{doFetch:j,error:s,isLoading:u,response:v}}n(8045);function L(e){e.stopPropagation()}function A(e){var t=e.activeFile,n=(0,g.Z)(),s=(0,i.Z)(n,2),a=s[0],o=a.files,c=a.parse_pages_result,l=(s[1].updateFiles,o.find((function(e){return e.id==t}))),u=(c.find((function(e){return e.id==t}))||{rects:[]}).rects,f=(0,r.useRef)(),p=(0,r.useReducer)((function(e){var t=f.current&&f.current.getBoundingClientRect();return t?[t.width,t.height]:(setTimeout(x,100),e)}),["100%","100%"]),v=(0,i.Z)(p,2),h=v[0],x=v[1];return(0,r.useEffect)((function(){setTimeout(x,100)}),[l]),(0,d.jsx)("div",{style:{overflow:"auto",height:"100%",width:"100%",maxWidth:"70vw"},children:(0,d.jsxs)("div",{style:{position:"relative"},children:[(0,d.jsx)("img",{src:l.preview,ref:f,alt:l.file.name}),(0,d.jsx)("svg",{style:{position:"absolute",top:0,left:0},width:h[0],height:h[1],children:u.map((function(e){var t=e.coords,n=e.literal,r="M"+t.concat([t[0]]).map((function(e){var t=(0,i.Z)(e,2),n=t[0],r=t[1];return"".concat(n," ").concat(r)})).join("L");return(0,d.jsx)(w.Z,{title:n,children:(0,d.jsx)("path",{className:"wordrect",d:r})})}))})]})})}function D(){var e=(0,h.Z)(),t=(0,i.Z)(e,2)[1],n=t.raiseAlert,l=t.openTab,u=(0,g.Z)(),p=(0,i.Z)(u,2),x=p[0],m=x.files,Z=x.socketRef,j=x.parse_pages_result,w=x.waitingTicket,y=p[1],b=y.updateFiles,S=y.set_parse_pages_result,E=y.SET_WAITING_TICKET,_=(0,r.useState)(null),I=(0,i.Z)(_,2),T=I[0],N=I[1],D=(0,r.useState)(null),z=(0,i.Z)(D,2),H=z[0],B=z[1],G=function(e){var t=e.linkName,n=void 0===t?"file_receiver":t,s=(0,h.Z)(),a=(0,i.Z)(s,2)[1].raiseAlert,o=(0,r.useState)(null),c=(0,i.Z)(o,2),l=c[0],u=c[1],d=P({method:"post",headers:{"Content-Type":"multipart/form-data"},url:F.Z[n]}),f=d.doFetch,p=d.error,v=d.isLoading,g=d.response;return(0,r.useEffect)((function(){!p&&!g||v||(u(!p),a(p?{text:"\u041f\u0440\u0438 \u043f\u0435\u0440\u0435\u0434\u0430\u0447\u0435 \u0434\u0430\u043d\u043d\u044b\u0445 \u043d\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443 \u0432\u043e\u0437\u043d\u0438\u043a\u043b\u0438 \u043f\u0440\u043e\u0431\u043b\u0435\u043c\u044b",type:"error"}:{text:"\u0414\u0430\u043d\u043d\u044b\u0435 \u043f\u0435\u0440\u0435\u0434\u0430\u043d\u044b \u043d\u0430 \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u043a\u0443",type:"info",duration:-1}))}),[p,v,g]),{send:(0,r.useCallback)((function(e){var t=new FormData;e.forEach((function(e,n){var i=e.file;e.visible&&t.append("page-".concat(n),i)})),f({data:t})}),[]),success:l,response:g}}({updateFiles:b}),K=G.send,M=(G.success,G.response),W=P({method:"post",url:F.Z.extract}),q=W.doFetch,O=W.response,Y=W.error,J=(W.isLoading,W.isRequestingRects),Q=(0,r.useCallback)(v()(q,100),[]);(0,r.useEffect)((function(){console.log(O),w&&!J&&O&&O.data&&O.data.ticket==w&&(n({text:"\u0414\u0430\u043d\u043d\u044b\u0435 \u0443\u0441\u043f\u0435\u0448\u043d\u043e \u043e\u0431\u0440\u0430\u0431\u043e\u0442\u0430\u043d\u044b",type:"success"}),E(null),S(m.filter((function(e){return e.visible})).map((function(e,t){return{id:e.id,rects:O.data.rects[t]}}))))}),[J,O,w]),(0,r.useEffect)((function(){!J&&Y&&setTimeout((function(){Q({data:{ticket:w}})}),1e3)}),[J,Y,w]),(0,r.useEffect)((function(){w&&(Z.current.emit("wait",{task:w}),Q({data:{ticket:w}}))}),[w,Q]),(0,r.useEffect)((function(){M&&E(M.data)}),[M]);(0,r.useCallback)((function(e){b({type:"add",files:e,updateFiles:b,raiseAlert:n})}),[]);return(0,r.useEffect)((function(){j&&0!=j.length||K(m)}),[]),(0,d.jsxs)("div",{width:"100vw",height:"100vh",className:"pageRoot",style:{maxHeight:"100vh"},children:[(0,d.jsxs)(c.Z,{onClick:function(e){L(e),l("startPage")},variant:"extended",className:"fab-prev",children:[(0,d.jsx)(a.Z,{}),"\u0412\u0435\u0440\u043d\u0443\u0442\u044c\u0441\u044f \u043a \u0437\u0430\u0433\u0440\u0443\u0437\u043a\u0435 \u0444\u0430\u0439\u043b\u043e\u0432"]}),(0,d.jsxs)(c.Z,{onClick:function(e){L(e),K(m)},disabled:0==m.length,variant:"extended",className:"fab-next",children:[(0,d.jsx)(s.Z,{}),"\u041f\u0435\u0440\u0435\u0432\u044b\u043f\u043e\u043b\u043d\u0438\u0442\u044c \u0430\u043d\u0430\u043b\u0438\u0437"]}),(0,d.jsx)(o.Z,{open:!!T,onClose:function(e){e.stopPropagation(),N(null)},children:(0,d.jsx)("img",{src:T,onClick:L})}),(0,d.jsxs)("div",{className:"dropzone-calm_root",children:[(0,d.jsx)("div",{className:"dropzone-header"}),(0,d.jsxs)("div",{onClick:L,className:"dropzone-content-container",style:{display:"flex"},children:[(0,d.jsx)("div",{style:{flexGrow:1,flexBasis:"30vw",position:"relative",overflowY:"auto"},children:(0,d.jsx)(f,{items:m,setItems:function(e){return b({type:"set",files:e})},getListStyle:C,getItemStyle:k,itemClickHandler:function(e){B(e.id)},content:R({setZoomed:N,updateFiles:b,canRemove:!1})})}),(0,d.jsx)("div",{style:{flexGrow:2,flexBasis:"70vw",position:"relative"},children:H&&(0,d.jsx)(A,{activeFile:H})})]})]})]})}},8045:function(e,t,n){n.r(t),t.default={}}}]);
//# sourceMappingURL=286.cdea49d9.chunk.js.map